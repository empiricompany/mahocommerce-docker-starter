FROM debian:stable-slim

LABEL author="Simone Fantini"
LABEL email="simone@ecommerce.mi.it"

# Install dependencies and mkcert
RUN apt-get update && \
    apt-get install -y \
      ca-certificates \
      curl \
      gnupg \
      && curl -JLO "https://github.com/FiloSottile/mkcert/releases/download/v1.4.3/mkcert-v1.4.3-linux-amd64" \
      && chmod +x mkcert-v1.4.3-linux-amd64 \
      && mv mkcert-v1.4.3-linux-amd64 /usr/local/bin/mkcert \
      && mkcert -install

# Create a directory for SSL certificates
RUN mkdir -p /certs

# Set the working directory
WORKDIR /certs

# Set the entrypoint for mkcert
CMD ["sh", "-c", "mkcert -key-file /certs/nginx.key -cert-file /certs/nginx.crt ${DOMAIN} 127.0.0.1 ::1"]